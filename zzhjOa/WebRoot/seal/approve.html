<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>审批</title>
		<link rel="stylesheet" type="text/css" href="../easyui/themes/icon.css">
		<link rel="stylesheet" type="text/css" href="../easyui/themes/default/easyui.css">
		<link rel="stylesheet" type="text/css" href="../easyui/demo/demo.css">
		<script type="text/javascript" src="../easyui/jquery.min.js"></script>
		<script type="text/javascript" src="../easyui/jquery.easyui.min.js"></script>
		<script type="text/javascript" src="../easyui/locale/easyui-lang-zh_CN.js"></script>
	</head>
	<style type="text/css">
		
	</style>
	
	<body>
		<!--审批表格-->
		 <div id="spproveTb">
			<a  class="easyui-linkbutton" iconCls="icon-add" plain="true" onclick="addSpproveTb()" >查看</a>
			<a  class="easyui-linkbutton" iconCls="icon-remove" plain="true" onclick="deleteSpprove()">删除</a>
			
		</div>
		<!--<div id="approveDg"></div><--></-->
		<div id="spprove-tanc"> 
			<form action="" method="post" id="approve-form">
  			   <table>
  			   		<tr>
  			   			<td colspan="2"><h2>资质章盖章申请单</h2></td>
  			   		</tr>
  			   		<tr>
  			   			<td>编号</td>
  			   			<td><input type="text" name="id2"  value="" readonly="readonly" class="apply-val" /></td>
  			   		</tr>
  			   		<tr>
  			   			<td>项目名称</td>
  			   			<td><input type="text" name="projectName2" readonly="readonly" value="" class="apply-val"/></td>
  			   		</tr>
  			   		
  			   		<tr>
  			   			<td>盖章内容</td>
  			   			<td>
  			   		
  			   				<textarea name="text2"  rows="" cols="" readonly="readonly" class="apply-val"></textarea>
  			   			</td>
  			   		</tr>
  			   		<tr>
  			   			<td>盖章事由</td>
  			   			<td>	
  			   				<textarea name="why2" rows="" cols="" readonly="readonly" class="apply-val"></textarea>
  			   			</td>
  			   		</tr>
  			   		 
  			   		<tr>
  			   			<td>页数</td>
  			   			<td><input type="text" name="pageNumber2" readonly="readonly" value="" class="apply-val "/></td>
  			   		</tr>
  			   		<tr>
  			   			<td>份数</td>
  			   			<td><input type="tel" name="copiesNumber2" readonly="readonly" value="" class="apply-val" /></td>
  			   			<!--onkeyup="(this.v=function(){this.value=this.value.replace(/[^0-9-]+/,'');}).call(this)" onblur="this.v();"-->
  			   		</tr>
  			   		<tr align="center">
  			   			<td colspan="2"><input type="button" value="审批" onclick="applySubmit()"/></td>
  			   			<td colspan="2"><input type="button" value="退回" onclick="applyReturn()"/></td>
  			   		</tr>
  			   
  			   </table>
  			</form>

		</div>
		
		
		
		<table id="approveDg"></table>
		


		<script type="text/javascript">	
		var datagridData = {                                                     
		    "total":12,                                                     
		    "rows":[                                                         
		        {"number":"001","projectName":"Name1","userName":"Name 1","requestDate":"2052","text":"2052","why":"2052","pageNumber":"2052","copiesNumber":"2052","approver":"2052",},        
		        {"number":"001","projectName":"Name1","userName":"Name 1","requestDate":"2052","text":"2052","why":"2052","pageNumber":"2052","copiesNumber":"2052","approver":"2052",},        
		        {"number":"001","projectName":"Name1","userName":"Name 1","requestDate":"2052","text":"2052","why":"2052","pageNumber":"2052","copiesNumber":"2052","approver":"2052",},        
		        {"number":"001","projectName":"Name1","userName":"Name 1","requestDate":"2052","text":"2052","why":"2052","pageNumber":"2052","copiesNumber":"2052","approver":"2052",},        
		        {"number":"001","projectName":"Name1","userName":"Name 1","requestDate":"2052","text":"2052","why":"2052","pageNumber":"2052","copiesNumber":"2052","approver":"2052",},        
		        {"number":"001","projectName":"Name1","userName":"Name 1","requestDate":"2052","text":"2052","why":"2052","pageNumber":"2052","copiesNumber":"2052","approver":"2052",},        
		        {"number":"001","projectName":"Name1","userName":"Name 1","requestDate":"2052","text":"2052","why":"2052","pageNumber":"2052","copiesNumber":"2052","approver":"2052",},        
		    ]                                                         
		}
		
		var approveDg = undefined; //主datagrid
		var spprove_tanc = undefined; // 弹层
		approveDg = $('#approveDg').datagrid({
			// url:'ziZhiSeal/queryOneself.action',
			data:datagridData,
			rownumbers:true,
		    singleSelect:true, 
			nowarp:false,
		    fit:true, 
		    fitColumns:true,
		    border:false,
		    toolbar:'#spproveTb', 
		   	columns:[[    
	        {field:'id',title:'编号',checkbox:true,}, 
			{field:'number',title:'编号',width:100,},       
			{field:'projectName',title:'项目名称',width:100,},
			{field:'userId',title:'申请人',width:100,},
			{field:'requestDate',title:'申请时间',width:100,},
			{field:'text',title:'盖章内容',width:100,},  
			{field:'why',title:'盖章事由',width:100,},
			{field:'pageNumber',title:'页数',width:100,},   
			{field:'copiesNumber',title:'份数',width:100,},        		
			{field:'approver',title:'审批人',width:100,},
			{field:'agent',title:'经办人',width:100,},   	        		
        		{field:'overDate',title:'盖章时间',width:100,},
        		{field:'state',title:'状态',width:50,},
		    ]],
		})
		
		spprove_tanc = $('#spprove-tanc').dialog({
			title : '审批',
			width : 400,
			height : 400,
			closed : true,
			cache : false,
			modal : true
		});	
		//查看
		function addSpproveTb(){		
			//var row = $('#approveDg').datagrid('getChecked');  你这个是选择所以行
			var row = $('#approveDg').datagrid('getSelected');
			if(row == null){
			   alert("请选择一条数据");
			}else{
				$("input[name = id2]").val(row.number);
				$("input[name = number2]").val(row.number);
				$("input[name = projectName2]").val(row.projectName);
				$("input[name = pageNumber2]").val(row.pageNumber);
				$("input[name = copiesNumber2]").val(row.copiesNumber);
				$("textarea[name = text2]").val(row.text);
				$("textarea[name = why2]").val(row.why);
				spprove_tanc.dialog('open') // 打开dialog
//				spprove_tanc.dialog('close') // 关闭dialog
			}
			console.log(row)
			
			
		};
		
		//
		function deleteSpprove(){	
			var row = $("#approveDg").datagrid('getSelected');
			if(row){
				$.post('ziZhiSeal/delete.action',{'id':row.id},function(data){
					if(data!=null&&data>0){
						$("#approveDg").datagrid('reload');
						 $.messager.alert("提示", "删除成功", "info"); 
					}
				})
			}else{
				 $.messager.alert("提示", "请选中一行信息", "info");  
			}
		
		}
		
		
		//审批提交
		function applySubmit(){	
			$ajax({
//				   url:"ziZhiSeal/approver.action",
				   type:"post",
				   data:$("#approve-form").serialize(),	
				   dataType:"",			   
				   success:function(data){
					   if(data == 1){
					   		$('#approve-tanc').dialog({
								closed : true,
							});
					   //	alert("审批完成");
					   	spprove_tanc.dialog('close');
					   }else{
					   	alert("提交失败");
					   	
					   }
				   }
			})
		}
  		 //	
  		 function applySubmit(){	
			$ajax({
//				   url:"ziZhiSeal/approver.action",
				   type:"post",
				   data:$("#approve-form").serialize(),	
				   dataType:"",			   
				   success:function(data){
					   if(data == 1){
					   		$('#approve-tanc').dialog({
								closed : true,
							});
					   //	alert("审批完成");
					   	spprove_tanc.dialog('close');
					   }else{
					   	alert("提交失败");
					   	
					   }
				   }
			})
		}
  		 //退回
  		
  		 function  applyReturn(){	
			$ajax({
//				   url:"ziZhiSeal/approver.action",
				   type:"post",
				   data:$("#approve-form").serialize(),	
				   dataType:"",			   
				   success:function(data){
					   if(data == 1){
					   		$('#approve-tanc').dialog({
								closed : true,
							});
					   //	alert("审批完成");
					   	spprove_tanc.dialog('close');
					   }else{
					   	alert("提交失败");
					   	
					   }
				   }
			})
		}

		

  	</script>
		
	</body>
</html>
